<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debt Empire Verifier v3.0 | RBI OTS Compliant</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; color: #333; display: flex; min-height: 100vh; }
        .main-content { flex: 3; padding: 30px; background: white; overflow-y: auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #1b5e20; font-size: 28px; margin-bottom: 10px; }
        .header .subtitle { color: #555; font-size: 16px; }
        .sidebar { flex: 1; background: #2c3e50; color: white; padding: 20px; overflow-y: auto; }
        .sidebar h2 { font-size: 18px; margin-bottom: 20px; color: #3498db; text-align: center; }
        .btn { display: inline-block; padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; margin: 5px; transition: background 0.3s; }
        .btn:hover { background: #2980b9; }
        .btn-success { background: #27ae60; }
        .btn-success:hover { background: #229954; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        .loan-tree { margin: 20px 0; }
        .loan-item { padding: 15px; margin: 10px 0; background: #f8f9fa; border-left: 4px solid #3498db; border-radius: 5px; }
        .loan-item.running { border-left-color: #27ae60; }
        .loan-item.negotiating { border-left-color: #f39c12; }
        .loan-item.closed { border-left-color: #95a5a6; }
        .loan-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .loan-title { font-weight: bold; font-size: 16px; }
        .loan-badge { padding: 3px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .badge-running { background: #27ae60; color: white; }
        .badge-negotiating { background: #f39c12; color: white; }
        .badge-closed { background: #95a5a6; color: white; }
        .loan-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 14px; }
        .detail-item { display: flex; justify-content: space-between; }
        .detail-label { color: #7f8c8d; }
        .detail-value { font-weight: bold; }
        .drop-zone { border: 3px dashed #3498db; border-radius: 10px; padding: 30px; text-align: center; background: rgba(52, 152, 219, 0.1); cursor: pointer; transition: all 0.3s; margin-bottom: 20px; }
        .drop-zone:hover { background: rgba(52, 152, 219, 0.2); border-color: #2980b9; }
        .drop-zone.drag-over { background: rgba(46, 204, 113, 0.3); border-color: #27ae60; }
        .file-list { background: rgba(0,0,0,0.2); border-radius: 8px; padding: 15px; max-height: 200px; overflow-y: auto; }
        .file-item { display: flex; align-items: center; padding: 8px; margin-bottom: 6px; background: rgba(255,255,255,0.1); border-radius: 5px; font-size: 13px; }
        .file-item.duplicate { background: rgba(231, 76, 60, 0.3); }
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: white; border-radius: 12px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; padding: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .modal h3 { color: #1b5e20; margin-bottom: 16px; }
        .modal .step { margin-bottom: 14px; }
        .modal .step label { display: block; font-size: 12px; color: #555; margin-bottom: 4px; }
        .modal .step input, .modal .step select { width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
        .doc-options { margin: 12px 0; }
        .doc-options button { display: block; width: 100%; text-align: left; padding: 10px 14px; margin-bottom: 6px; background: rgba(255,255,255,0.1); border: 1px solid #3498db; border-radius: 6px; color: white; cursor: pointer; font-size: 13px; }
        .doc-options button:hover { background: rgba(52, 152, 219, 0.3); }
        .dup-warn { background: rgba(231, 76, 60, 0.3); border: 1px solid #e74c3c; border-radius: 6px; padding: 10px; margin: 10px 0; font-size: 12px; display: none; }
        .dup-warn.show { display: block; }
        .preview-json { background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 6px; font-family: monospace; font-size: 12px; white-space: pre-wrap; word-break: break-all; max-height: 180px; overflow-y: auto; margin: 10px 0; }
        .preview-tree { font-family: monospace; font-size: 12px; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 6px; margin: 10px 0; }
        .success-msg { background: rgba(46, 204, 113, 0.3); border: 1px solid #27ae60; border-radius: 8px; padding: 14px; margin: 12px 0; font-size: 13px; display: none; }
        .success-msg.show { display: block; }
        .ps-cmd { background: #2d2d2d; color: #f8f8f2; padding: 12px; border-radius: 6px; font-family: monospace; font-size: 11px; white-space: pre-wrap; word-break: break-all; margin: 10px 0; }
        select.loan-select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #3498db; background: #34495e; color: white; font-size: 14px; margin-bottom: 12px; }
        @media print { .sidebar, .modal-overlay, .no-print { display: none !important; } .main-content { flex: 1; padding: 15px; } }
        @media (max-width: 768px) { body { flex-direction: column; } .sidebar { order: 2; } .main-content { order: 1; } }
    </style>
</head>
<body>
    <!-- ===== SIDEBAR: ENTRY + FLOWS ===== -->
    <div class="sidebar no-print">
        <h2>ü§ñ DEBT EMPIRE VERIFIER v3.0</h2>
        <p style="font-size: 12px; color: #bdc3c7; text-align: center; margin-bottom: 16px;">RBI OTS Compliant</p>
        <button class="btn btn-success" style="width: 100%; margin: 0 0 10px 0;" onclick="openLoanWizard()">NEW LOAN</button>
        <button class="btn" style="width: 100%; margin: 0 0 14px 0;" onclick="showDocFlow()">NEW DOCUMENT</button>
        <label style="font-size: 12px; color: #bdc3c7;">Select loan:</label>
        <select id="loanSelect" class="loan-select" onchange="onLoanSelect()">
            <option value="">‚Äî Select ‚Äî</option>
            <option value="baj47L">baj47L (400LAP14914207)</option>
            <option value="lt908">lt908 (BL240910207908339)</option>
            <option value="bjmagnarepay1">bjmagnarepay1 (H400FBL0337784)</option>
            <option value="__add__">+ ADD NEW LOAN</option>
        </select>
        <div id="docFlowPanel" style="display: none;">
            <p style="font-size: 12px; margin-bottom: 8px;">üìÅ Drag ANY document here</p>
            <div id="dropZone" class="drop-zone">
                <div>üìÅ</div>
                <p><strong>Drop file here</strong></p>
                <small>PDF ¬∑ DOCX ¬∑ JPG ¬∑ CSV ¬∑ XLSX</small>
                <input type="file" id="fileInput" accept=".pdf,.docx,.xlsx,.xls,.jpg,.jpeg,.png,.csv" multiple style="display: none;">
            </div>
            <div id="dupWarn" class="dup-warn">‚ö†Ô∏è ALREADY EXISTS (same file).</div>
            <div class="doc-options">
                <button type="button" onclick="setDocType(1)">[1] INTEREST CERT ‚Üí Parse rate/GST</button>
                <button type="button" onclick="setDocType(2)">[2] WELCOME LETTER ‚Üí Extract terms/dates</button>
                <button type="button" onclick="setDocType(3)">[3] EMI RUNNING STATEMENT ‚Üí Update EMI/OS</button>
                <button type="button" onclick="setDocType(4)">[4] CLOSING LETTER/NOC ‚Üí Set status=CLOSED</button>
                <button type="button" onclick="setDocType(5)">[5] OTHER LOAN DOC ‚Üí Manual category</button>
            </div>
            <div class="file-list" id="fileList"></div>
            <button class="btn btn-success" style="width: 100%;" onclick="showReviewSave()">REVIEW & SAVE</button>
        </div>
        <div id="reviewPanel" style="display: none;">
            <h3 style="font-size: 14px; margin-bottom: 8px;">üìÅ loans/<span id="reviewLoanName">‚Äî</span>/</h3>
            <div class="preview-tree" id="folderPreview"></div>
            <p style="font-size: 11px; margin: 8px 0;">UPDATE PREVIEW:</p>
            <div class="preview-json" id="jsonPreview"></div>
            <button class="btn btn-success" style="width: 100%; margin: 4px 0;" onclick="doSaveRefresh()">‚úÖ SAVE & REFRESH DASHBOARD</button>
            <button class="btn" style="width: 100%; margin: 4px 0;" onclick="backToWizard()">‚úèÔ∏è EDIT FIELDS</button>
            <button class="btn btn-danger" style="width: 100%; margin: 4px 0;" onclick="cancelReview()">üóëÔ∏è CANCEL</button>
            <div id="successMsg" class="success-msg">Saved. Run this command ‚Üí Then click REFRESH DASHBOARD</div>
            <div class="ps-cmd" id="psCmdBlock"></div>
            <button class="btn" style="width: 100%; margin-top: 8px;" onclick="copyPsCmd()">Copy PowerShell Command</button>
        </div>
        <div style="margin-top: 20px; text-align: center;">
            <a href="verifier.html" class="btn" style="text-decoration: none; display: block;">üìä MASTER DASHBOARD</a>
        </div>
    </div>

    <!-- ===== MAIN CONTENT: DASHBOARD (100% PRESERVED) ===== -->
    <div class="main-content">
        <div class="header">
            <h1>DEBT EMPIRE VERIFIER</h1>
            <div class="subtitle">Loan Verification & OTS Management Dashboard</div>
        </div>
        <div class="loan-tree">
            <div class="loan-item running">
                <div class="loan-header">
                    <div class="loan-title">L&T Finance - BL240910207908339</div>
                    <div class="loan-badge badge-running">üü¢ RUNNING</div>
                </div>
                <div class="loan-details">
                    <div class="detail-item"><span class="detail-label">Borrower:</span><span class="detail-value">Muddu Surendra Nehru</span></div>
                    <div class="detail-item"><span class="detail-label">Outstanding:</span><span class="detail-value">‚Çπ25,74,000</span></div>
                    <div class="detail-item"><span class="detail-label">OTS Offer (70%):</span><span class="detail-value">‚Çπ18,01,800</span></div>
                    <div class="detail-item"><span class="detail-label">EMI:</span><span class="detail-value">‚Çπ80,000</span></div>
                    <div class="detail-item"><span class="detail-label">Savings:</span><span class="detail-value">‚Çπ7,72,200</span></div>
                </div>
            </div>
            <div class="loan-item running">
                <div class="loan-header">
                    <div class="loan-title">HDFC Bank - HDFC24LOAN1</div>
                    <div class="loan-badge badge-running">üü¢ RUNNING</div>
                </div>
                <div class="loan-details">
                    <div class="detail-item"><span class="detail-label">Borrower:</span><span class="detail-value">Muddu Surendra Nehru</span></div>
                    <div class="detail-item"><span class="detail-label">Outstanding:</span><span class="detail-value">‚Çπ24,50,000</span></div>
                    <div class="detail-item"><span class="detail-label">OTS Offer (70%):</span><span class="detail-value">‚Çπ17,15,000</span></div>
                    <div class="detail-item"><span class="detail-label">EMI:</span><span class="detail-value">‚Çπ1,89,000</span></div>
                    <div class="detail-item"><span class="detail-label">Savings:</span><span class="detail-value">‚Çπ7,35,000</span></div>
                </div>
            </div>
            <div class="loan-item running">
                <div class="loan-header">
                    <div class="loan-title">Bajaj Finance - 400DFR47319474 ‚Üí 400LAP14914207</div>
                    <div class="loan-badge badge-running">üü¢ RUNNING (Flexi)</div>
                </div>
                <div class="loan-details">
                    <div class="detail-item"><span class="detail-label">Borrower:</span><span class="detail-value">Muddu Surendra Nehru</span></div>
                    <div class="detail-item"><span class="detail-label">Outstanding:</span><span class="detail-value">‚Çπ7,90,000</span></div>
                    <div class="detail-item"><span class="detail-label">OTS Offer (70%):</span><span class="detail-value">‚Çπ5,53,000</span></div>
                    <div class="detail-item"><span class="detail-label">EMI:</span><span class="detail-value">‚Çπ35,000</span></div>
                    <div class="detail-item"><span class="detail-label">Savings:</span><span class="detail-value">‚Çπ2,37,000</span></div>
                    <div class="detail-item"><span class="detail-label">Type:</span><span class="detail-value">Flexi Revolving Credit</span></div>
                </div>
            </div>
            <div class="loan-item running">
                <div class="loan-header">
                    <div class="loan-title">Tata Capital - TATA24</div>
                    <div class="loan-badge badge-running">üü¢ RUNNING</div>
                </div>
                <div class="loan-details">
                    <div class="detail-item"><span class="detail-label">Borrower:</span><span class="detail-value">Muddu Surendra Nehru</span></div>
                    <div class="detail-item"><span class="detail-label">Outstanding:</span><span class="detail-value">‚Çπ3,20,000</span></div>
                    <div class="detail-item"><span class="detail-label">OTS Offer (70%):</span><span class="detail-value">‚Çπ2,24,000</span></div>
                    <div class="detail-item"><span class="detail-label">EMI:</span><span class="detail-value">‚Çπ15,000</span></div>
                    <div class="detail-item"><span class="detail-label">Savings:</span><span class="detail-value">‚Çπ96,000</span></div>
                </div>
            </div>
        </div>
        <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin-top: 20px; text-align: center;">
            <h3 style="color: #1b5e20; margin-bottom: 10px;">TOTAL SAVINGS POTENTIAL</h3>
            <div style="font-size: 32px; font-weight: bold; color: #d32f2f;">‚Çπ18,40,200</div>
            <div style="margin-top: 10px; color: #555;">(30% of total exposure)</div>
        </div>
        <div style="margin-top: 20px; text-align: center;" class="no-print">
            <button class="btn" style="background: #27ae60;" onclick="window.print()">üñ®Ô∏è PRINT DASHBOARD (Ctrl+P)</button>
            <a href="verifier.html" class="btn" style="background: #3498db; margin-left: 10px; text-decoration: none; display: inline-block;">üìä MASTER DASHBOARD</a>
            <button class="btn" onclick="location.reload()">REFRESH DASHBOARD</button>
        </div>
    </div>

    <!-- NEW LOAN WIZARD MODAL -->
    <div id="wizardModal" class="modal-overlay">
        <div class="modal">
            <h3>NEW LOAN WIZARD</h3>
            <div class="step"><label>Step 1: Loan Name (short code)</label><input type="text" id="wizLoanName" placeholder="bjmagnarepay2"></div>
            <div class="step"><label>Step 2: Account Number</label><input type="text" id="wizAccount" placeholder="H400FBL9999999"></div>
            <div class="step"><label>Step 3: Borrower Name</label><input type="text" id="wizBorrower" value="muddu surendra nehru"></div>
            <div class="step"><label>Step 4: Current Outstanding (‚Çπ)</label><input type="number" id="wizOS" placeholder="4356000"></div>
            <div class="step"><label>Step 5: Monthly EMI (‚Çπ)</label><input type="number" id="wizEMI" placeholder="54000"></div>
            <div class="step"><label>Step 6: Loan Type</label><select id="wizType"><option value="Standard">Standard</option><option value="Flexi">Flexi</option><option value="Personal">Personal</option></select></div>
            <div class="step"><label>Step 7: Disbursal Date</label><input type="date" id="wizDisbursal" value="2022-10-15"></div>
            <button class="btn btn-success" style="width: 100%;" onclick="createLoanFolder()">‚úÖ CREATE LOAN FOLDER</button>
            <button class="btn" style="width: 100%; margin-top: 8px;" onclick="closeWizard()">Close</button>
        </div>
    </div>

    <script>
        (function() {
            var STORAGE_KEY = 'debt_empire_verifier_draft';
            var docHashes = {}; // loanId -> { filename: hash }
            var selectedLoan = '';
            var pendingFiles = [];
            var docType = 0;
            var wizardData = {};

            function loadMasters() {
                try {
                    fetch('masters.json').then(function(r) { return r.json(); }).then(function(data) {
                        var sel = document.getElementById('loanSelect');
                        if (!data.loans || !data.loans.length) return;
                        sel.innerHTML = '<option value="">‚Äî Select ‚Äî</option>';
                        data.loans.forEach(function(l) {
                            var code = (l.account_ref || l.provider || '').replace(/\s/g, '').toLowerCase().slice(0, 14);
                            sel.appendChild(new Option((code || l.provider) + ' (' + (l.account_ref || '‚Äî') + ')', code || l.account_ref));
                        });
                        sel.appendChild(new Option('+ ADD NEW LOAN', '__add__'));
                    }).catch(function() {});
                } catch (e) {}
            }
            if (typeof fetch !== 'undefined') loadMasters();

            window.openLoanWizard = function() {
                var d = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                document.getElementById('wizLoanName').value = d.loanName || '';
                document.getElementById('wizAccount').value = d.account || '';
                document.getElementById('wizBorrower').value = d.borrower || 'muddu surendra nehru';
                document.getElementById('wizOS').value = d.os || '';
                document.getElementById('wizEMI').value = d.emi || '';
                document.getElementById('wizType').value = d.type || 'Standard';
                document.getElementById('wizDisbursal').value = d.disbursal || '2022-10-15';
                document.getElementById('wizardModal').classList.add('show');
            };
            window.closeWizard = function() { document.getElementById('wizardModal').classList.remove('show'); };
            window.createLoanFolder = function() {
                wizardData = {
                    loanName: document.getElementById('wizLoanName').value.trim() || 'bjmagnarepay2',
                    account: document.getElementById('wizAccount').value.trim() || 'H400FBL9999999',
                    borrower: document.getElementById('wizBorrower').value.trim() || 'muddu surendra nehru',
                    os: document.getElementById('wizOS').value || '4356000',
                    emi: document.getElementById('wizEMI').value || '54000',
                    type: document.getElementById('wizType').value,
                    disbursal: document.getElementById('wizDisbursal').value
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(wizardData));
                closeWizard();
                var sel = document.getElementById('loanSelect');
                var opt = new Option(wizardData.loanName + ' (' + wizardData.account + ')', wizardData.loanName);
                sel.insertBefore(opt, sel.lastChild);
                sel.value = wizardData.loanName;
                showDocFlow();
            };

            window.onLoanSelect = function() {
                var v = document.getElementById('loanSelect').value;
                if (v === '__add__') { openLoanWizard(); return; }
                selectedLoan = v;
                if (v) showDocFlow();
            };
            window.showDocFlow = function() {
                selectedLoan = document.getElementById('loanSelect').value;
                if (selectedLoan === '__add__' || !selectedLoan) return;
                document.getElementById('docFlowPanel').style.display = 'block';
                document.getElementById('reviewPanel').style.display = 'none';
            };
            window.setDocType = function(n) { docType = n; };

            var dropZone = document.getElementById('dropZone');
            var fileInput = document.getElementById('fileInput');
            dropZone.onclick = function() { fileInput.click(); };
            fileInput.onchange = function(e) { handleFiles(e.target.files); };
            ['dragenter','dragover','dragleave','drop'].forEach(function(ev) {
                dropZone.addEventListener(ev, function(e) { e.preventDefault(); e.stopPropagation(); });
            });
            dropZone.addEventListener('dragenter', function() { dropZone.classList.add('drag-over'); });
            dropZone.addEventListener('dragleave', function() { dropZone.classList.remove('drag-over'); });
            dropZone.addEventListener('drop', function(e) { dropZone.classList.remove('drag-over'); handleFiles(e.dataTransfer.files); });

            function hashFile(file, cb) {
                if (!window.crypto || !crypto.subtle) { cb(file.name + '-' + file.size); return; }
                var r = new FileReader();
                r.onload = function() {
                    crypto.subtle.digest('SHA-256', r.result).then(function(buf) {
                        var h = Array.from(new Uint8Array(buf)).map(function(b) { return ('0'+b.toString(16)).slice(-2); }).join('');
                        cb(h);
                    }).catch(function() { cb(file.name + '-' + file.size); });
                };
                r.readAsArrayBuffer(file);
            }
            function handleFiles(fileList) {
                for (var i = 0; i < fileList.length; i++) {
                    var file = fileList[i];
                    hashFile(file, function(h) {
                        var key = selectedLoan + '_hashes';
                        var store = JSON.parse(localStorage.getItem(key) || '{}');
                        var dup = store[file.name] === h;
                        if (dup) {
                            document.getElementById('dupWarn').textContent = '‚ö†Ô∏è ALREADY EXISTS: ' + file.name;
                            document.getElementById('dupWarn').classList.add('show');
                        } else {
                            store[file.name] = h;
                            localStorage.setItem(key, JSON.stringify(store));
                            pendingFiles.push({ name: file.name, type: docType, size: file.size });
                            renderFileList();
                        }
                    });
                }
            }
            function renderFileList() {
                var el = document.getElementById('fileList');
                el.innerHTML = pendingFiles.map(function(f) {
                    var t = ['','Interest Cert','Welcome Letter','EMI Statement','Closing/NOC','Other'][f.type] || 'Other';
                    return '<div class="file-item">üìÑ ' + f.name + ' ‚Üí ' + t + '</div>';
                }).join('');
            }

            window.showReviewSave = function() {
                document.getElementById('reviewPanel').style.display = 'block';
                var loan = selectedLoan || wizardData.loanName || 'bjmagnarepay1';
                document.getElementById('reviewLoanName').textContent = loan;
                var docs = pendingFiles.length || 3;
                var total = 5;
                var lines = ['‚îú‚îÄ‚îÄ interest-cert.pdf ‚úÖ','‚îú‚îÄ‚îÄ welcome-letter.pdf ‚úÖ','‚îú‚îÄ‚îÄ emi-running.pdf ‚Üê NEW'].slice(0, Math.max(docs, 3));
                if (docs > 3) lines.push('‚îú‚îÄ‚îÄ closing-noc.pdf');
                if (docs > 4) lines.push('‚îî‚îÄ‚îÄ other.pdf');
                else lines[lines.length-1] = '‚îî‚îÄ‚îÄ ' + (pendingFiles[pendingFiles.length-1] ? pendingFiles[pendingFiles.length-1].name : 'other.pdf');
                document.getElementById('folderPreview').textContent = 'üìÅ loans/' + loan + '/ (' + docs + '/' + total + ' docs)\n' + lines.join('\n');
                var emi = wizardData.emi || document.getElementById('wizEMI').value || 54000;
                var os = wizardData.os || document.getElementById('wizOS').value || 4356000;
                var preview = {};
                preview[loan] = { emi: parseInt(emi,10), os: parseInt(os,10), status: 'active', docs: docs + '/' + total, last_updated: new Date().toLocaleString('en-IN', { dateStyle: 'short', timeStyle: 'short' }) + ' by Human' };
                document.getElementById('jsonPreview').textContent = JSON.stringify(preview, null, 2);
            };

            window.doSaveRefresh = function() {
                var loan = selectedLoan || wizardData.loanName || 'bjmagnarepay1';
                localStorage.setItem(STORAGE_KEY + '_saved_' + loan, new Date().toISOString());
                document.getElementById('successMsg').textContent = 'Saved. Run this command ‚Üí Then click REFRESH DASHBOARD';
                document.getElementById('successMsg').classList.add('show');
                var borrower = (wizardData.borrower || document.getElementById('wizBorrower').value || 'muddu surendra nehru').trim();
                var account = wizardData.account || document.getElementById('wizAccount').value || 'H400FBL9999999';
                var os = wizardData.os || document.getElementById('wizOS').value || 4356000;
                var emi = wizardData.emi || document.getElementById('wizEMI').value || 54000;
                var disb = wizardData.disbursal || document.getElementById('wizDisbursal').value || '2022-10-15';
                var psCmd = 'py loan_verifier.py << EOF\n1\n4\n' + borrower + '\n' + account + '\n' + os + '\n' + emi + '\n' + disb + '\ny\n4\nEOF';
                document.getElementById('psCmdBlock').textContent = psCmd;
            };
            window.copyPsCmd = function() {
                var t = document.getElementById('psCmdBlock').textContent;
                if (navigator.clipboard && navigator.clipboard.writeText) navigator.clipboard.writeText(t);
                else prompt('Copy this:', t);
            };
            window.backToWizard = function() { openLoanWizard(); document.getElementById('reviewPanel').style.display = 'none'; };
            window.cancelReview = function() {
                document.getElementById('reviewPanel').style.display = 'none';
                document.getElementById('successMsg').classList.remove('show');
                pendingFiles = [];
            };
        })();
    </script>
</body>
</html>
